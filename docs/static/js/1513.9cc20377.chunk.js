/*! For license information please see 1513.9cc20377.chunk.js.LICENSE.txt */
(self.webpackChunkbmstu_navigator=self.webpackChunkbmstu_navigator||[]).push([[1513],{1513:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});const o="connector",c={name:o,async init(t){const e=this,{svgCanvas:c}=e,{getElement:r,$id:s,$click:a,addSVGElementsFromJson:l}=c,{svgroot:i,selectorManager:d}=t,u=c.getEditorNS();let g,m,f,p,h;await async function(t){let e;const c=t.configObj.pref("lang");try{e=await n(2281)("./".concat(c,".js"))}catch(r){console.warn("Missing translation (".concat(c,") for ").concat(o," - using 'en'")),e=await n.e(8363).then(n.bind(n,8363))}t.i18next.addResourceBundle(c,o,e.default)}(e);let b=!1,_=[];const v=c.groupSelectedElements;c.groupSelectedElements=function(){c.removeFromSelection(document.querySelectorAll('[id^="conn_"]'));for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return v.apply(this,e)};const y=c.moveSelectedElements;c.moveSelectedElements=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=y.apply(this,e);return B(c.getSelectedElements()),o};const S=(t,e,n,o)=>{o&&((n={...n}).width+=o,n.height+=o,n.x-=o/2,n.y-=o/2);const c=n.x+n.width/2,r=n.y+n.height/2,s=t-c,a=e-r;let l;return l=Math.abs(a/s)<n.height/n.width?n.width/2/Math.abs(s):a?n.height/2/Math.abs(a):0,{x:c+s*l,y:r+a*l}},x=(t,e)=>{const n=e.getAttribute("marker-"+t),o=5*e.getAttribute("stroke-width");return n?o:0},k=t=>{let e=s("connector_rules");e||(e=document.createElement("style"),e.setAttribute("id","connector_rules"),document.getElementsByTagName("head")[0].appendChild(e)),e.textContent=t?"#tool_clone, #tool_topath, #tool_angle, #xy_panel { display: none !important; }":"",s("connector_rules")&&(s("connector_rules").style.display=t?"block":"none")},w=(t,e,n,o,c)=>{const r=t.points,s=i.createSVGPoint();if(s.x=n,s.y=o,"end"===e&&(e=r.numberOfItems-1),r.replaceItem(s,e),c){const e=r.getItem(0),n=r.getItem(r.numberOfItems-1);w(t,1,(n.x+e.x)/2,(n.y+e.y)/2)}},E=(t,e,n,o,c,r)=>{const s=o.x+o.width/2,a=o.y+o.height/2,l=S(s,a,n,x(c,t));w(t,e.is_start?0:"end",l.x,l.y,!0);const i=S(l.x,l.y,o,x(r,t));w(t,e.is_start?"end":0,i.x,i.y,!0)},N=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=c.getDataStorage(),n=document.querySelectorAll('[id^="conn_"]');_=[];for(const o of n){let n=!1;const r=[];for(const[t,s]of["start","end"].entries()){let n=e.get(o,"c_".concat(s));n?n=document.getElementById(n):(n=document.getElementById(o.attributes["se:connector"].value.split(" ")[t]),e.put(o,"c_".concat(s),n.id),e.put(o,"".concat(s,"_bb"),c.getStrokedBBox([n]))),r.push(n)}for(let e=0;e<2;e++){const s=r[e],a=c.getParents(null===s||void 0===s?void 0:s.parentNode);for(const e of a)if(t.includes(e)){n=!0;break}if(s&&s.parentNode){if(t.includes(s)||n){const t=c.getStrokedBBox([s]);_.push({elem:s,connector:o,is_start:0===e,start_x:t.x,start_y:t.y})}}else o.remove()}}},B=t=>{const e=c.getDataStorage();if(N(t),_.length)for(const n of _){const{elem:t,connector:o,is_start:r,start_x:s,start_y:a}=n,l=r?"start":"end",i=c.getStrokedBBox([t]);i.x=s,i.y=a,e.put(o,"".concat(l,"_bb"),i);const d=r?"end":"start",u=e.get(o,"".concat(d,"_bb")),g=(null===u||void 0===u?void 0:u.x)+(null===u||void 0===u?void 0:u.width)/2,m=(null===u||void 0===u?void 0:u.y)+(null===u||void 0===u?void 0:u.height)/2,f=S(g,m,i,x(l,o));w(o,r?0:"end",f.x,f.y,!0);const p=S(f.x,f.y,e.get(o,"".concat(d,"_bb")),x(d,o));w(o,r?"end":0,p.x,p.y,!0)}},A=()=>{const t=c.getDataStorage();c.getSvgContent().querySelectorAll("*").forEach((e=>{const n=e.getAttributeNS(u,"connector");if(n){const o=n.split(" "),s=c.getStrokedBBox([r(o[0])]),a=c.getStrokedBBox([r(o[1])]);t.put(e,"c_start",o[0]),t.put(e,"c_end",o[1]),t.put(e,"start_bb",s),t.put(e,"end_bb",a),c.getEditorNS(!0)}}))};return A(),{name:e.i18next.t("".concat(o,":name")),callback(){const t=document.createElement("template"),e="".concat(o,":buttons.0.title");t.innerHTML='\n         <se-button id="tool_connect" title="'.concat(e,'" src="conn.svg"></se-button>\n         '),s("tools_left").append(t.content.cloneNode(!0)),a(s("tool_connect"),(()=>{this.leftPanel.updateLeftPanel("tool_connect")&&c.setMode("connector")}))},mouseDown(t){const n=c.getDataStorage(),o=c.getSvgContent(),{event:r,start_x:s,start_y:a}=t,i=c.getMode(),{curConfig:{initStroke:d}}=e.configObj;if("connector"===i){if(b)return;const t=r.target;if(c.getParents(t.parentNode).includes(o)){const e=c.getClosest(t.parentNode,"foreignObject");p=e||t;const o=c.getStrokedBBox([p]),r=o.x+o.width/2,i=o.y+o.height/2;b=!0,f=l({element:"polyline",attr:{id:"conn_"+c.getNextId(),points:"".concat(r,",").concat(i," ").concat(r,",").concat(i," ").concat(s,",").concat(a),stroke:"#".concat(d.color),"stroke-width":p.stroke_width&&0!==p.stroke_width?p.stroke_width:d.width,fill:"none",opacity:d.opacity,style:"pointer-events:none"}}),n.put(f,"start_bb",o)}return{started:!0}}"select"===i&&N(t.selectedElements)},mouseMove(t){if(0===_.length)return;const e=c.getDataStorage(),n=c.getZoom(),o=t.mouse_x/n,r=t.mouse_y/n;if(!g||!m)return;const s=o-g,a=r-m,l=c.getMode();if("connector"===l&&b){const t=S(o,r,e.get(f,"start_bb"),x("start",f));g=t.x,m=t.y,w(f,0,t.x,t.y,!0),w(f,"end",o,r,!0)}else if("select"===l){for(const t of c.getSelectedElements())t&&e.has(t,"c_start")&&(c.removeFromSelection([t]),t.transform.baseVal.clear());_.length&&((t,e)=>{const n=c.getDataStorage();for(const o of _){const{connector:c,is_start:r,start_x:s,start_y:a}=o,l=r?"start":"end",i=r?"end":"start",d={...n.get(c,"".concat(l,"_bb"))};d.x=s+t,d.y=a+e,n.put(c,"".concat(l,"_bb"),d);const u=n.get(c,"".concat(i,"_bb"));E(c,o,d,u,l,i)}})(s,a)}},mouseUp(t){var e,n;const o=c.getDataStorage(),r=c.getSvgContent(),{event:s}=t;let a=s.target;if("connector"!==c.getMode())return;const l=c.getClosest(a.parentNode,"foreignObject");l&&(a=l);const i=c.getParents(a.parentNode).includes(r);if(a===p)return b=!0,{keep:!0,element:null,started:b};var _;if(!i)return null===(_=f)||void 0===_||_.remove(),b=!1,{keep:!1,element:null,started:b};h=a;const v=(null===(e=p)||void 0===e?void 0:e.id)||"",y=(null===(n=h)||void 0===n?void 0:n.id)||"",k="".concat(v," ").concat(y),E="".concat(y," ").concat(v);if(Array.from(document.querySelectorAll('[id^="conn_"]')).filter((t=>t.getAttributeNS(u,"connector")===k||t.getAttributeNS(u,"connector")===E)).length)return f.remove(),{keep:!1,element:null,started:!1};const N=c.getStrokedBBox([h]),B=S(g,m,N,x("start",f));return w(f,"end",B.x,B.y,!0),o.put(f,"c_start",v),o.put(f,"c_end",y),o.put(f,"end_bb",N),f.setAttributeNS(u,"se:connector",k),f.setAttribute("opacity",1),c.addToSelection([f]),c.moveToBottomSelectedElement(),d.requestSelector(f).showGrips(!1),b=!1,{keep:!0,element:f,started:b}},selectedChanged(t){const e=c.getDataStorage();if(!c.getSvgContent().querySelectorAll('[id^="conn_"]').length)return;"connector"===c.getMode()&&c.setMode("select");const{elems:n}=t;for(const o of n)o&&e.has(o,"c_start")?(d.requestSelector(o).showGrips(!1),k(t.selectedElement&&!t.multiselected)):k(!1);B(c.getSelectedElements())},elementChanged(t){var e;const n=c.getDataStorage();let[o]=t.elems;if(!o)return;"svg"===o.tagName&&"svgcontent"===o.id&&A();const{markerStart:s,markerMid:a,markerEnd:i}=o.attributes;if((s||a||i)&&(f=o,n.put(o,"start_off",Boolean(s)),n.put(o,"end_off",Boolean(i)),"line"===o.tagName&&a)){const{x1:t,x2:e,y1:n,y2:r,id:s}=o.attributes,i="".concat((Number(t.value)+Number(e.value))/2,",").concat((Number(n.value)+Number(r.value))/2),d=l({element:"polyline",attr:{points:"".concat(t.value,",").concat(n.value," ").concat(i," ").concat(e.value,",").concat(r.value),stroke:o.getAttribute("stroke"),"stroke-width":o.getAttribute("stroke-width"),"marker-mid":a.value,fill:"none",opacity:o.getAttribute("opacity")||1}});o.insertAdjacentElement("afterend",d),o.remove(),c.clearSelection(),d.id=s.value,c.addToSelection([d]),o=d}if(null!==(e=o)&&void 0!==e&&e.id.startsWith("conn_")){const t=r(n.get(o,"c_start"));B([t])}else B(c.getSelectedElements())},IDsUpdated(t){const e=[];return t.elems.forEach((function(n){"se:connector"in n.attr&&(n.attr["se:connector"]=n.attr["se:connector"].split(" ").map((function(e){return t.changes[e]})).join(" "),/. ./.test(n.attr["se:connector"])||e.push(n.attr.id))})),{remove:e}},toolButtonStateUpdate(t){const n=document.getElementById("tool_connect");t.nostroke&&!0===n.pressed&&e.clickSelect(),n.disabled=t.nostroke}}}}},2281:(t,e,n)=>{var o={"./en.js":[8363,8363],"./fr.js":[561,561],"./zh-CN.js":[1924,1979]};function c(t){if(!n.o(o,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=o[t],c=e[0];return n.e(e[1]).then((()=>n(c)))}c.keys=()=>Object.keys(o),c.id=2281,t.exports=c}}]);
//# sourceMappingURL=1513.9cc20377.chunk.js.map